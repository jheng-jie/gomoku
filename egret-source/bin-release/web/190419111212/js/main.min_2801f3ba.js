var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r["throw"](e))}catch(t){a(t)}}function c(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,a&&(o=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,a=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(r){i=[6,r],a=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},gamePlatform=function(){function e(){this.face=0,this.name="",this.webSocket=new egret.WebSocket}return e.prototype.connect=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.socketReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CONNECT,e.success,this),this.webSocket.addEventListener(egret.Event.CLOSE,function(){platform.alert({title:"連線錯誤",type:"error"}),e.fail()},this),this.webSocket.connect("192.168.8.78",32767),[2]})})},e.prototype.socketSendMessage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.webSocket.writeUTF(JSON.stringify(e)),[2]})})},e.prototype.socketReceiveMessage=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=this.webSocket.readUTF(),this.receiveMessage&&this.receiveMessage(JSON.parse(e)),[2]})})},e.prototype.setData=function(e){e.face&&(this.face=e.face),e.name&&(this.name=e.name)},e.prototype.alert=function(e){window.swal?window.swal.fire(e):alert(e.text||e.title)},e}();__reflect(gamePlatform.prototype,"gamePlatform",["Platform"]),window.platform||(window.platform=new gamePlatform);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function r(r){t.call(i,r,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?r(n):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=450,this.textField.height=800,this.textField.verticalAlign=egret.VerticalAlign.MIDDLE,this.textField.textAlign=egret.HorizontalAlign.CENTER},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var login=function(e){function t(t){var i=e.call(this)||this;return i.faceStartX=0,i.faceOriginX=0,i.faceIndex=0,i.fragment="\n        precision lowp float;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        uniform sampler2D uSampler;\n        uniform vec2 center;\n        uniform vec3 params;\n        uniform float time;\n        void main()\n        {\n            vec2 uv = vTextureCoord.xy;\n            vec2 texCoord = uv;\n            float dist = distance(uv, center);\n            if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n            {\n                float diff = (dist - time);\n                float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n                float diffTime = diff  * powDiff;\n                vec2 diffUV = normalize(uv - center);\n                texCoord = uv + (diffUV * diffTime);\n            }\n            gl_FragColor = texture2D(uSampler, texCoord);\n        }\n    ",i.vertex="\n        attribute vec2 aVertexPosition;\n        attribute vec2 aTextureCoord;\n        attribute vec2 aColor;\n        uniform vec2 projectionVector;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        const vec2 center = vec2(-1.0, 1.0);\n        void main(void) {\n            gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n            vTextureCoord = aTextureCoord;\n            vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n        }\n    ",i.visible=!1,i.controller=t,i.stageW=i.controller.stage.stageWidth,i.stageH=i.controller.stage.stageHeight,i.once(egret.Event.ADDED_TO_STAGE,i.createGameScene,i),i}return __extends(t,e),t.prototype.createGameScene=function(){var e=this.stageW,t=this.stageH,i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawRect(0,0,e,t),i.graphics.endFill(),i.alpha=0,this.addChild(i);var r=new egret.TextField;r.text="Gomoku",r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.size=100,r.width=e,r.height=.25*t,r.x=0,r.y=0,r.bold=!0,this.addChild(r);var n=new egret.CustomFilter(this.vertex,this.fragment,{center:{x:.5,y:.5},params:{x:10,y:1,z:.1},time:0});this.filter=n,this.filterAnimate=TweenMax.fromTo(n.uniforms,2,{time:0},{time:2.5,delay:.5});var a=new eui.Group;a.y=.25*t,a.x=0;for(var o=0;6>o;o++){var s=new egret.Bitmap;s.texture=RES.getRes(o+"_png"),s.width=s.height=280,s.anchorOffsetX=.5*s.width,s.anchorOffsetY=.5*s.height,s.filters=[n],a.addChild(s),s.x=.5*e+o*e,s.y=.2*t}this.addChild(a),this.faceGroup=a;var c=new egret.Shape;c.graphics.beginFill(16711680),c.graphics.drawRect(0,a.y,e,.4*t),c.graphics.endFill(),this.addChild(c),a.mask=c;var h=new egret.TextField;h.text="Nickname :",h.textAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.width=.3*e,h.height=.1*t,h.size=24,h.x=0,h.y=.7*t,h.bold=!0,this.addChild(h);var l=new egret.TextField;l.text="abc",l.width=.7*e,l.height=.1*t,l.x=.3*e,l.y=.7*t,l.verticalAlign=egret.VerticalAlign.MIDDLE,l.textAlign=egret.HorizontalAlign.CENTER,this.addChild(l);var u=new egret.Shape;u.graphics.lineStyle(3,16777215),u.graphics.moveTo(.3*e,.7*t+60),u.graphics.lineTo(.95*e,.7*t+60),this.addChild(u);var d=new customerButton({x:.5*e,y:.88*t,text:"NEXT"});this.addChild(d),Object.defineProperty(this,"show",{get:function(){return this.visible},set:function(e){if(this.visible!=e){var t=e?this.stageW:0,i=e?0:-this.stageW;this.x=t,e?(this.visible=e,TweenMax.to(this,1,{x:i,onComplete:function(){this.target.listener()}})):(this.listener(),TweenMax.to(this,1,{x:i,onComplete:function(){this.target.visible=!1}}))}}}),this.view={input:l,nextButton:d}},t.prototype.listener=function(){var e=this.view,t=this.show?"addEventListener":"removeEventListener";e.nextButton[t](egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),e.nextButton[t](egret.TouchEvent.TOUCH_END,this.onTouch,this),this[t](egret.TouchEvent.TOUCH_BEGIN,this.onFace,this),this[t](egret.TouchEvent.TOUCH_END,this.onFace,this),this[t](egret.TouchEvent.TOUCH_MOVE,this.onFace,this),e.input[t](egret.FocusEvent.FOCUS_IN,this.onInput,this),e.input[t](egret.FocusEvent.FOCUS_OUT,this.onInput,this),this.view.input.type=this.show?egret.TextFieldType.INPUT:egret.TextFieldInputType.TEXT},t.prototype.onInput=function(e){switch(e.type){case"focusIn":"please input name"==e.target.text.trim()&&(e.target.text="");break;case"focusOut":""==e.target.text.trim()?e.target.text="please input name":e.target.text=e.target.text.trim()}},t.prototype.onFace=function(e){var t=this.stageW,i=this.stageH;switch(e.type){case"touchBegin":this.faceHold=!0,this.faceStartX=e.stageX,this.faceOriginX=this.faceGroup.x,this.faceAnimate&&(this.faceAnimate.kill(),this.faceAnimate=void 0);break;case"touchMove":this.faceHold&&(this.faceGroup.x=this.faceOriginX-2*(this.faceStartX-e.stageX));break;case"touchEnd":if(this.faceHold){var r=this.faceGroup.x,n=5*t+.5*t;r>0?(this.faceGroup.x=Math.min(r,t),this.faceIndex=0):-n>r?(this.faceGroup.x=Math.max(r,-n),this.faceIndex=5):this.faceIndex=Math.round(Math.abs(r)/t)}var a=this.faceGroup.x,o=this.faceIndex*-t;this.faceAnimate=TweenMax.to(this.faceGroup,Math.abs(a-o)/250,{x:o,ease:Elastic.easeOut.config(1,.3)}),this.filter.uniforms.center.x=(e.stageX-.5*t)/280+.5,this.filter.uniforms.center.y=(e.stageY-.45*i)/280+.5,this.filterAnimate.invalidate(),this.filterAnimate.restart(),this.faceHold=!1}},t.prototype.onTouch=function(e){if(e.target.touchEvent(e),"touchEnd"==e.type){var t=this.view.input.text,i="";if((0==t.length||"please input name"==t)&&(i="請輸入名稱"),i.length>0)return void platform.alert({title:i});platform.setData({name:this.view.input.text,face:this.faceIndex}),this.controller.connection()}},t}(eui.Component);__reflect(login.prototype,"login");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=t.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return i.sent(),this.stage.removeChild(e),[3,4];case 3:return t=i.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;mouse.enable(this.stage),mouse.setMouseMoveEnabled(!0),this.loading=new loading({width:e,height:t}),this.addChild(this.loading),this.screne={login:new login(this),game:new game(this)},this.addChild(this.screne.login),this.addChild(this.screne.game),Object.defineProperty(this,"active",{get:function(){return this._active},set:function(e){this._active!=e&&this.screne[e]&&(this._active&&(this.screne[this._active].show=!1),this._active=e,this.screne[this._active].show=!0)}}),this.active="login"},t.prototype.socketMessage=function(e){switch(console.log(e),e.type){case"login":if(platform.uuid=e.uuid,"game"==this.active){var t=this.screne[this.active];t.userInit(e.user),1==e.status?t.setStatus(2):t.setStatus(0)}break;case"user":if("game"==this.active){var i=this.screne[this.active];switch(e.method){case"add":var r=e.data;i.userScroll.add({name:r.n,face:r.f,status:r.s,uuid:r.u});break;case"status":for(var n in e.data){var a=e.data[n];i.userScroll.setStatus(a.uuid,a.status),a.uuid==platform.uuid&&i.setStatus(1)}break;case"remove":var o=e.data;i.userScroll.remove(o)}}break;case"game":if("game"!=this.active)return;var s=this.screne[this.active];switch(e.method){case"start":for(var n in e.data){var a=e.data[n];s.userScroll.setStatus(a.uuid,a.status)}e.holder==platform.uuid?(s.pieceType=0,s.holder=!0):(s.pieceType=1,s.holder=!1),s.setStatus(2);break;case"over":for(var c in s.userScroll.list){var a=s.userScroll.list[c];s.userScroll.setStatus(a.uuid,0)}s.setStatus(0);break;case"mousemove":s.view.piece.x=e.data.x,s.view.piece.y=e.data.y;break;case"piece":s.holder=e.data.holder==platform.uuid,s.pushPiece(e.data.index,e.data.pieceType)}}},t.prototype.connection=function(){var e=this;platform.connect({success:function(){e.active="game",e.screne[e.active].userScroll.init(),platform.receiveMessage=function(t){e.socketMessage(t)},platform.socketSendMessage({type:"login",face:platform.face,name:platform.name})},fail:function(){e.loading.show=!1,e.active="login"}})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var game=function(e){function t(t){var i=e.call(this)||this;return i.fragment="\n        precision lowp float;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        uniform sampler2D uSampler;\n        uniform vec2 center;\n        uniform vec3 params;\n        uniform float time;\n        void main()\n        {\n            vec2 uv = vTextureCoord.xy;\n            vec2 texCoord = uv;\n            float dist = distance(uv, center);\n            if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n            {\n                float diff = (dist - time);\n                float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n                float diffTime = diff  * powDiff;\n                vec2 diffUV = normalize(uv - center);\n                texCoord = uv + (diffUV * diffTime);\n            }\n            gl_FragColor = texture2D(uSampler, texCoord);\n        }\n    ",i.vertex="\n        attribute vec2 aVertexPosition;\n        attribute vec2 aTextureCoord;\n        attribute vec2 aColor;\n        uniform vec2 projectionVector;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        const vec2 center = vec2(-1.0, 1.0);\n        void main(void) {\n            gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n            vTextureCoord = aTextureCoord;\n            vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n        }\n    ",i.removeList=[],i.visible=!1,i.controller=t,i.stageW=i.controller.stage.stageWidth,i.stageH=i.controller.stage.stageHeight,i.once(egret.Event.ADDED_TO_STAGE,i.createGameScene,i),i}return __extends(t,e),t.prototype.listener=function(){var e=this.view,t=this.show?"addEventListener":"removeEventListener";e.checkerboard[t](mouse.MouseEvent.MOUSE_MOVE,this.onMouseMove,this),e.checkerboard[t](egret.TouchEvent.TOUCH_END,this.onCheckerboardTouch,this),e.checkerboard[t](egret.TouchEvent.TOUCH_END,this.onCheckerboardTouch,this),e.readyButton[t](egret.TouchEvent.TOUCH_END,this.onButton,this),e.checkerboard.filters=this.show?[this.filter]:[]},t.prototype.onButton=function(e){switch(e.target.id){case"ready":platform.socketSendMessage({type:"game",method:"ready"})}},t.prototype.onCheckerboardTouch=function(e){if(2==this.status&&this.holder){var t,i,r=this.view.pieceAlpha,n=this.distance;t=Math.round(r.x/n),i=Math.round(r.y/n);var a=15*i+t;-1!=this.checkerboardList[a]||0>t||0>i||t>15||i>15||(this.holder=!1,platform.socketSendMessage({type:"game",method:"select",data:{x:t,y:i}}))}},t.prototype.onMouseMove=function(e){if(2==this.status&&this.holder){var t=this.view.pieceAlpha,i=this.view.piece,r=e.stageX-this.offsetX,n=e.stageY-this.offsetY,a=this.distance,o=Math.round(r/a),s=Math.round(n/a);t.x=o*a,t.y=s*a,i.x=e.stageX,i.y=e.stageY,platform.socketSendMessage({type:"game",method:"mousemove",data:{x:e.stageX,y:e.stageY}})}},t.prototype.setStatus=function(e){var t=this.view;switch(this.status=e,e){case 0:t.title.text="Gomoku",t.readyButton.visible=!0,t.piece.visible=!1,this.checkerboardList=[];break;case 1:t.title.text="Waiting ...",t.readyButton.visible=!1,t.piece.visible=!1,this.checkerboardList=[];break;case 2:t.readyButton.visible=!1,t.title.text="Playing ...",t.piece.visible=!0;for(var i=0;225>i;i++)this.checkerboardList.push(-1);for(var r in this.removeList)this.view.checkerboard.removeChild(this.removeList[r]);this.removeList.length=0,this.removeList=[]}},t.prototype.pushPiece=function(e,t){this.checkerboardList[e]=t;var i=new egret.Bitmap;this.removeList.push(i),i.texture=RES.getRes(0==t?"black_png":"white_png"),i.width=i.height=30,i.anchorOffsetX=i.anchorOffsetY=15,i.x=e%15*this.distance,i.y=Math.floor(e/15)*this.distance,this.view.checkerboard.addChild(i),this.filter.uniforms.center.x=i.x/this.checkerboardSize,this.filter.uniforms.center.y=1-i.y/this.checkerboardSize,this.filterAnimate.invalidate(),this.filterAnimate.restart()},t.prototype.createGameScene=function(){var e=this.stageW,t=this.stageH,i=new egret.Shape;i.x=0,i.y=0,i.graphics.beginFill(0),i.graphics.drawRect(5,5,e-10,.2*t-10),i.graphics.endFill(),i.alpha=.2,this.addChild(i),this.userScroll=new userScrollview({width:e,height:.2*t}),this.addChild(this.userScroll);var r=new egret.TextField;r.text="Gomoku",r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.width=e,r.height=50,r.size=36,r.x=0,r.y=.2*t+10,r.bold=!0,this.addChild(r);var n=new customerButton({id:"ready",height:40,x:.5*e,y:t-35,text:"READY"});this.addChild(n);var a=new egret.CustomFilter(this.vertex,this.fragment,{center:{x:.5,y:.5},params:{x:10,y:.5,z:.1},time:2});this.filter=a,this.filterAnimate=TweenMax.fromTo(a.uniforms,1,{time:0},{time:2,delay:.5});var o=new eui.Group;this.addChild(o),o.x=.5*e,this.offsetY=.2*t+70,this.checkerboardSize=t-(.2*t+140),this.offsetX=.5*(e-this.checkerboardSize);var s=this.checkerboardSize;o.y=.2*t+70+.5*s,this.distance=s/14,o.anchorOffsetX=.5*s,o.anchorOffsetY=.5*s;var c=new egret.Shape;c.graphics.beginFill(16777215,.5),c.graphics.lineStyle(2,0),c.graphics.drawRect(0,0,s,s),c.graphics.endFill(),o.addChild(c);var h=14,l=s/h;c.graphics.lineStyle(1,0);for(var u=0;h>=u;u++){var d=u*l;c.graphics.moveTo(d,0),c.graphics.lineTo(d,s),c.graphics.moveTo(0,d),c.graphics.lineTo(s,d)}for(var g=0;5>g;g++){c.graphics.lineStyle(0,0),c.graphics.beginFill(0);var d=2==g?.5*s:l*(3+(g%2==0?0:8)),p=2==g?.5*s:l*(3+(2>g?0:8));c.graphics.drawCircle(d,p,5),c.graphics.endFill()}var f=new egret.Bitmap;f.width=f.height=30,f.anchorOffsetX=f.anchorOffsetY=15,f.alpha=.45,f.visible=!1,o.addChild(f);var v=new egret.Bitmap;v.width=v.height=30,v.anchorOffsetX=v.anchorOffsetY=15,v.visible=!1,this.addChild(v),this.view={checkerboard:o,pieceAlpha:f,piece:v,readyButton:n,title:r},Object.defineProperty(this,"show",{get:function(){return this.visible},set:function(e){if(this.visible!=e){var t=e?this.stageW:0,i=e?0:-this.stageW;this.x=t,e?(this.visible=e,TweenMax.to(this,1,{x:i,onComplete:function(){this.target.listener()}})):(this.listener(),TweenMax.to(this,1,{x:i,onComplete:function(){this.target.visible=!1}}))}}}),Object.defineProperty(this,"holder",{get:function(){return this._holder},set:function(e){this._holder=e,this.view.pieceAlpha.visible=e,this.view.pieceAlpha.texture=RES.getRes(0==this.pieceType?"black_png":"white_png");var t="black_png";t=e?0==this.pieceType?"black_png":"white_png":1==this.pieceType?"black_png":"white_png",this.view.piece.x=-100,this.view.piece.y=-100,this.view.piece.texture=RES.getRes(t)}})},t.prototype.userInit=function(e){for(var t in e){var i=e[t];this.userScroll.add({name:i.n,face:i.f,status:i.s,uuid:i.u})}},t}(eui.Component);__reflect(game.prototype,"game");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,r){function n(e){t.call(r,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(c,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(r,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var background=function(e){function t(){var t=e.call(this)||this;t.timeOnEnterFrame=0,t.addEventListener(egret.Event.ENTER_FRAME,t.onEnterFrame,t),t.timeOnEnterFrame=egret.getTimer(),t.html=document.getElementsByTagName("html")[0],t.body=document.getElementsByTagName("body")[0],t.htmlStyle=t.html.style,t.htmlStyle.backgroundColor="transparent",t.body.style.backgroundColor="transparent";var i="resource/assets/bg.jpg";return t.htmlStyle.backgroundImage="url("+i+")",t.count=0,t}return __extends(t,e),t.prototype.onEnterFrame=function(e){this.count=this.count+.3,this.htmlStyle.backgroundPosition=this.count+"px "+this.count+"px"},t}(egret.DisplayObjectContainer);__reflect(background.prototype,"background");var customerButton=function(e){function t(t){var i=e.call(this)||this;return i.text=new egret.TextField,i.background=new egret.Shape,i.backgroundColor=16166712,i.backgroundTouchColor=6710886,i.w=t.width||120,i.h=t.height||60,i.x=t.x||0,i.y=t.y||0,i.id=t.id||"",i.background.graphics.beginFill(i.backgroundColor),i.background.graphics.drawRect(i.w*-.5,i.h*-.5,i.w,i.h),i.background.graphics.endFill(),i.addChild(i.background),i.text.text=t.text||"",i.text.width=i.w,i.text.height=i.h,i.text.x=i.w*-.5,i.text.y=i.h*-.5,i.text.size=t.size||20,i.text.verticalAlign=egret.VerticalAlign.MIDDLE,i.text.textAlign=egret.HorizontalAlign.CENTER,i.addChild(i.text),i}return __extends(t,e),t.prototype.touchEvent=function(e){switch(e.type){case"touchBegin":this.background.graphics.clear(),this.background.graphics.beginFill(this.backgroundTouchColor),this.background.graphics.drawRect(this.w*-.5,this.h*-.5,this.w,this.h),this.background.graphics.endFill();break;case"touchEnd":this.background.graphics.clear(),this.background.graphics.beginFill(this.backgroundColor),this.background.graphics.drawRect(this.w*-.5,this.h*-.5,this.w,this.h),this.background.graphics.endFill()}},t}(eui.Group);__reflect(customerButton.prototype,"customerButton");var loading=function(e){function t(t){var i=e.call(this)||this;return i.text=new egret.TextField,i.background=new egret.Shape,i.count=3,i.w=t.width||450,i.h=t.height||800,i.background.graphics.beginFill(0),i.background.graphics.drawRect(0,0,i.w,i.h),i.background.graphics.endFill(),i.background.alpha=.5,i.addChild(i.background),i.text.text="loading",i.text.width=i.w,i.text.height=i.h,i.text.verticalAlign=egret.VerticalAlign.MIDDLE,i.text.textAlign=egret.HorizontalAlign.CENTER,i.addChild(i.text),Object.defineProperty(i,"show",{get:function(){return this.visible},set:function(e){this.visible=e,this.visible?this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this):this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)}}),i.show=!1,i}return __extends(t,e),t.prototype.onEnterFrame=function(e){this.count+=.1,this.text.text="loading"+".".repeat(this.count%4),this.count>4&&(this.count=0)},t}(eui.Group);__reflect(loading.prototype,"loading");var userScrollview=function(e){function t(t){var i=e.call(this)||this;i.width=t.width||0,i.height=t.height||0,i.x=t.x||0,i.y=t.y||0;var r=new eui.Group;return i.setContent(r),i.content=r,i.content.height=1.005*i.height,i.horizontalScrollPolicy="off",i.list={},i}return __extends(t,e),t.prototype.init=function(){for(var e in this.list)this.content.removeChild(this.list[e].group),delete this.list[e]},t.prototype.add=function(e){var t=this.createUserItem(e);this.list[e.uuid]=t;var i=Object.keys(this.list).length;t.group.y=50*Object.keys(this.list).length-37.5,this.content.addChild(t.group),this.content.height=Math.max(50*i+12.5,1.005*this.height)},t.prototype.setStatus=function(e,t){var i=this.list[e];i&&(i.status.text=this.getStatusStr(parseInt(t)))},t.prototype.remove=function(e){var t=this.list[e];if(t){this.content.removeChild(t.group),delete this.list[e];var i=0;for(var r in this.list)this.list[r].group.y=50*++i-37.5;this.content.height=50*i+12.5}},t.prototype.createUserItem=function(e){var t=new eui.Group,i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawRect(0,0,this.width,50),i.graphics.endFill(),i.alpha=0,t.addChild(i);var r=new eui.Label;r.text=e.name||"unknow",r.width=175,r.anchorOffsetY=.5*r.height,r.size=24,r.bold=!0,r.x=75,r.y=25,t.addChild(r);var n=new eui.Label;n.width=175,n.anchorOffsetX=175,n.anchorOffsetY=.5*r.height,n.size=24,n.bold=!0,n.x=this.width-25,n.y=25,n.textAlign="right",n.text=this.getStatusStr(e.status||0),t.addChild(n);var a=new egret.Bitmap;a.texture=RES.getRes((e.face||0)+"_png"),a.width=40,a.height=40,a.x=40,a.y=25,a.anchorOffsetX=.5*a.width,a.anchorOffsetY=25,t.addChild(a);var o=new egret.Shape;return o.graphics.lineStyle(2,16777215),o.graphics.moveTo(75,45),o.graphics.lineTo(this.width-25,45),t.addChild(o),{group:t,status:n,data:e}},t.prototype.getStatusStr=function(e){switch(e){case 0:return"preparing";case 1:return"ready";case 2:return"playing";case 3:return"watch"}},t}(egret.ScrollView);__reflect(userScrollview.prototype,"userScrollview");