var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,a){function s(e){try{h(r.next(e))}catch(t){a(t)}}function o(e){try{h(r["throw"](e))}catch(t){a(t)}}function h(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(s,o)}h((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(s=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=t.call(e,h)}catch(r){i=[6,r],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},gamePlatform=function(){function e(){this.face=0,this.name=""}return e.prototype.connect=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){return this.webSocket=new egret.WebSocket,this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.socketReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CONNECT,e.success,this),this.webSocket.addEventListener(egret.Event.CLOSE,function(){platform.alert({title:"連線錯誤",type:"error"}),e.fail()},this),t=e.url||"192.168.8.78:32767",this.webSocket.connect(t.substring(0,t.lastIndexOf(":")),t.substring(t.lastIndexOf(":")+1,t.length)),[2]})})},e.prototype.socketSendMessage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.webSocket.writeUTF(JSON.stringify(e)),[2]})})},e.prototype.socketReceiveMessage=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=this.webSocket.readUTF(),this.receiveMessage&&this.receiveMessage(JSON.parse(e)),[2]})})},e.prototype.setData=function(e){e.face&&(this.face=e.face),e.name&&(this.name=e.name)},e.prototype.alert=function(e){window.swal?window.swal.fire(e):alert(e.text||e.title)},e}();__reflect(gamePlatform.prototype,"gamePlatform",["Platform"]),window.platform||(window.platform=new gamePlatform);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function r(r){t.call(i,r,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?r(n):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(t,i){var r=e.call(this)||this;return r.createView(t,i),r}return __extends(t,e),t.prototype.createView=function(e,t){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=e,this.textField.height=t,this.textField.verticalAlign=egret.VerticalAlign.MIDDLE,this.textField.textAlign=egret.HorizontalAlign.CENTER},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var login=function(e){function t(t){var i=e.call(this)||this;return i.faceStartX=0,i.faceOriginX=0,i.faceIndex=0,i.fragment="\n        precision lowp float;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        uniform sampler2D uSampler;\n        uniform vec2 center;\n        uniform vec3 params;\n        uniform float time;\n        void main()\n        {\n            vec2 uv = vTextureCoord.xy;\n            vec2 texCoord = uv;\n            float dist = distance(uv, center);\n            if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n            {\n                float diff = (dist - time);\n                float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n                float diffTime = diff  * powDiff;\n                vec2 diffUV = normalize(uv - center);\n                texCoord = uv + (diffUV * diffTime);\n            }\n            gl_FragColor = texture2D(uSampler, texCoord);\n        }\n    ",i.vertex="\n        attribute vec2 aVertexPosition;\n        attribute vec2 aTextureCoord;\n        attribute vec2 aColor;\n        uniform vec2 projectionVector;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        const vec2 center = vec2(-1.0, 1.0);\n        void main(void) {\n            gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n            vTextureCoord = aTextureCoord;\n            vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n        }\n    ",i.visible=!1,i.controller=t,i.stageW=i.controller.stage.stageWidth,i.stageH=i.controller.stage.stageHeight,i.once(egret.Event.ADDED_TO_STAGE,i.createGameScene,i),i}return __extends(t,e),t.prototype.createGameScene=function(){var e=this.stageW,t=this.stageH,i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawRect(0,0,e,t),i.graphics.endFill(),i.alpha=0,this.addChild(i);var r=new egret.TextField;r.text="Gomoku",r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.size=100,r.width=e,r.height=.25*t,r.x=0,r.y=0,r.bold=!0,this.addChild(r);var n=new egret.CustomFilter(this.vertex,this.fragment,{center:{x:.5,y:.5},params:{x:10,y:1,z:.1},time:0});this.filter=n,this.filterAnimate=TweenMax.fromTo(n.uniforms,2,{time:0},{time:2.5,delay:.5});var a=new eui.Group;a.y=.25*t,a.x=0;for(var s=0;6>s;s++){var o=new egret.Bitmap;o.texture=RES.getRes(s+"_png"),o.width=o.height=280,o.anchorOffsetX=.5*o.width,o.anchorOffsetY=.5*o.height,o.filters=[n],a.addChild(o),o.x=.5*e+s*e,o.y=.2*t}this.addChild(a),this.faceGroup=a;var h=new egret.Shape;h.graphics.beginFill(16711680),h.graphics.drawRect(0,a.y,e,.4*t),h.graphics.endFill(),this.addChild(h),a.mask=h;var c=new egret.TextField;c.text="Nickname :",c.textAlign=egret.HorizontalAlign.CENTER,c.verticalAlign=egret.VerticalAlign.MIDDLE,c.width=.3*e,c.height=.1*t,c.size=24,c.x=0,c.y=.7*t,c.bold=!0,this.addChild(c);var l=new egret.TextField;l.text=Math.floor(1e5*Math.random()).toString(),l.width=.7*e,l.height=.1*t,l.x=.3*e,l.y=.7*t,l.verticalAlign=egret.VerticalAlign.MIDDLE,l.textAlign=egret.HorizontalAlign.CENTER,this.addChild(l);var u=new egret.Shape;u.graphics.lineStyle(3,16777215),u.graphics.moveTo(.3*e,.7*t+60),u.graphics.lineTo(.95*e,.7*t+60),this.addChild(u);var d=new egret.TextField;d.text="192.168.8.78:32767",d.width=.7*e,d.height=40,d.x=.3*e,d.y=t-40,d.verticalAlign=egret.VerticalAlign.MIDDLE,d.textAlign=egret.HorizontalAlign.LEFT,d.size=24,this.addChild(d);var g=new egret.TextField;g.text="Socket Server : ",g.width=.3*e,g.height=40,g.x=0,g.y=t-40,g.verticalAlign=egret.VerticalAlign.MIDDLE,g.textAlign=egret.HorizontalAlign.RIGHT,g.size=24,this.addChild(g);var f=new customerButton({x:.5*e,y:.88*t,text:"NEXT"});this.addChild(f),Object.defineProperty(this,"show",{get:function(){return this.visible},set:function(e){if(this.visible!=e){var t=e?this.stageW:0,i=e?0:-this.stageW;this.x=t,e?(this.visible=e,TweenMax.to(this,1,{x:i,onComplete:function(){this.target.listener()}})):(this.listener(),TweenMax.to(this,1,{x:i,onComplete:function(){this.target.visible=!1}}))}}}),this.view={input:l,nextButton:f,inputURL:d}},t.prototype.listener=function(){var e=this.view,t=this.show?"addEventListener":"removeEventListener";e.nextButton[t](egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),e.nextButton[t](egret.TouchEvent.TOUCH_END,this.onTouch,this),this[t](egret.TouchEvent.TOUCH_BEGIN,this.onFace,this),this[t](egret.TouchEvent.TOUCH_END,this.onFace,this),this[t](egret.TouchEvent.TOUCH_MOVE,this.onFace,this),e.input[t](egret.FocusEvent.FOCUS_IN,this.onInput,this),e.input[t](egret.FocusEvent.FOCUS_OUT,this.onInput,this),this.view.input.type=this.show?egret.TextFieldType.INPUT:egret.TextFieldInputType.TEXT,this.view.inputURL.type=this.show?egret.TextFieldType.INPUT:egret.TextFieldInputType.TEXT},t.prototype.onInput=function(e){switch(e.type){case"focusIn":"please input name"==e.target.text.trim()&&(e.target.text="");break;case"focusOut":""==e.target.text.trim()?e.target.text="please input name":e.target.text=e.target.text.trim()}},t.prototype.onFace=function(e){var t=this.stageW,i=this.stageH;switch(e.type){case"touchBegin":this.faceHold=!0,this.faceStartX=e.stageX,this.faceOriginX=this.faceGroup.x,this.faceAnimate&&(this.faceAnimate.kill(),this.faceAnimate=void 0);break;case"touchMove":this.faceHold&&(this.faceGroup.x=this.faceOriginX-2*(this.faceStartX-e.stageX));break;case"touchEnd":if(this.faceHold){var r=this.faceGroup.x,n=5*t+.5*t;r>0?(this.faceGroup.x=Math.min(r,t),this.faceIndex=0):-n>r?(this.faceGroup.x=Math.max(r,-n),this.faceIndex=5):this.faceIndex=Math.round(Math.abs(r)/t)}var a=this.faceGroup.x,s=this.faceIndex*-t;this.faceAnimate=TweenMax.to(this.faceGroup,Math.abs(a-s)/250,{x:s,ease:Elastic.easeOut.config(1,.3)}),this.filter.uniforms.center.x=(e.stageX-.5*t)/280+.5,this.filter.uniforms.center.y=(e.stageY-.25*i-140)/280+.5,this.filterAnimate.invalidate(),this.filterAnimate.restart(),this.faceHold=!1}},t.prototype.onTouch=function(e){if(e.target.touchEvent(e),"touchEnd"==e.type){var t=this.view.input.text,i="";if((0==t.length||"please input name"==t)&&(i="請輸入名稱"),i.length>0)return void platform.alert({title:i});platform.setData({name:this.view.input.text,face:this.faceIndex}),this.controller.connection(this.view.inputURL.text)}},t}(eui.Component);__reflect(login.prototype,"login");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=t.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),e=new LoadingUI(this.stage.stageWidth,this.stage.stageHeight),this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return i.sent(),this.stage.removeChild(e),[3,4];case 3:return t=i.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;mouse.enable(this.stage),mouse.setMouseMoveEnabled(!0),this.loading=new loading({width:e,height:t}),this.addChild(this.loading),this.screne={login:new login(this),game:new game(this)},this.addChild(this.screne.login),this.addChild(this.screne.game),Object.defineProperty(this,"active",{get:function(){return this._active},set:function(e){this._active!=e&&this.screne[e]&&(this._active&&(this.screne[this._active].show=!1),this._active=e,this.screne[this._active].show=!0)}}),this.active="login"},t.prototype.socketMessage=function(e){switch(e.type){case"login":if(platform.uuid=e.uuid,"game"==this.active){var t=this.screne[this.active];t.userInit(e.user),1==e.status?t.setStatus(7,e.checkerboard):t.setStatus(0)}break;case"user":if("game"==this.active){var i=this.screne[this.active];switch(e.method){case"add":var r=e.data;i.userScroll.add({name:r.n,face:r.f,status:r.s,uuid:r.u});break;case"status":for(var n in e.data){var a=e.data[n];i.userScroll.setStatus(a.uuid,a.status),a.uuid==platform.uuid&&i.setStatus(1)}break;case"remove":var s=e.data;i.userScroll.remove(s)}}break;case"game":if("game"!=this.active)return;var o=this.screne[this.active];switch(e.method){case"start":for(var n in e.data){var a=e.data[n];o.userScroll.setStatus(a.uuid,a.status)}e.holder==platform.uuid?(o.pieceType=1,o.holder=!0):(o.pieceType=2,o.holder=!1),o.setStatus(2);break;case"over":for(var h in o.userScroll.list){var a=o.userScroll.list[h];o.userScroll.setStatus(a.uuid,0)}o.setStatus(0);break;case"mousemove":o.view.piece.x=e.data.x,o.view.piece.y=e.data.y;break;case"piece":o.holder=e.data.holder==platform.uuid,o.pushPiece(e.data.x,e.data.y,e.data.pieceType);break;case"finish":o.pushPiece(e.data.x,e.data.y,e.data.pieceType),o.userScroll.setStatus(e.data.winner,5),o.userScroll.setStatus(e.data.loser,6),e.data.winner==platform.uuid?o.setStatus(3):e.data.loser==platform.uuid?o.setStatus(4):o.setStatus(5);break;case"holder":o.holder=e.data==platform.uuid}}},t.prototype.connection=function(e){var t=this;platform.connect({url:e,success:function(){t.active="game",t.screne[t.active].userScroll.init(),platform.receiveMessage=function(e){t.socketMessage(e)},platform.socketSendMessage({type:"login",face:platform.face,name:platform.name})},fail:function(){t.loading.show=!1,t.active="login"}})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var game=function(e){function t(t){var i=e.call(this)||this;return i.fragment="\n        precision lowp float;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        uniform sampler2D uSampler;\n        uniform vec2 center;\n        uniform vec3 params;\n        uniform float time;\n        void main()\n        {\n            vec2 uv = vTextureCoord.xy;\n            vec2 texCoord = uv;\n            float dist = distance(uv, center);\n            if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n            {\n                float diff = (dist - time);\n                float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n                float diffTime = diff  * powDiff;\n                vec2 diffUV = normalize(uv - center);\n                texCoord = uv + (diffUV * diffTime);\n            }\n            gl_FragColor = texture2D(uSampler, texCoord);\n        }\n    ",i.vertex="\n        attribute vec2 aVertexPosition;\n        attribute vec2 aTextureCoord;\n        attribute vec2 aColor;\n        uniform vec2 projectionVector;\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n        const vec2 center = vec2(-1.0, 1.0);\n        void main(void) {\n            gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n            vTextureCoord = aTextureCoord;\n            vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n        }\n    ",i.removeList=[],i.visible=!1,i.controller=t,i.stageW=i.controller.stage.stageWidth,i.stageH=i.controller.stage.stageHeight,i.once(egret.Event.ADDED_TO_STAGE,i.createGameScene,i),i}return __extends(t,e),t.prototype.listener=function(){var e=this.view,t=this.show?"addEventListener":"removeEventListener";e.checkerboard[t](mouse.MouseEvent.MOUSE_MOVE,this.onMouseMove,this),e.checkerboard[t](egret.TouchEvent.TOUCH_END,this.onCheckerboardTouch,this),e.checkerboard[t](egret.TouchEvent.TOUCH_END,this.onCheckerboardTouch,this),e.readyButton[t](egret.TouchEvent.TOUCH_END,this.onButton,this),e.checkerboard.filters=this.show?[this.filter]:[]},t.prototype.onButton=function(e){switch(e.target.id){case"ready":platform.socketSendMessage({type:"game",method:"ready"})}},t.prototype.onCheckerboardTouch=function(e){if(2==this.status&&this.holder){var t,i,r=this.view.pieceAlpha,n=this.distance;t=Math.round(r.x/n),i=Math.round(r.y/n);var a=15*i+t;0!=this.checkerboardList[a]||0>t||0>i||t>15||i>15||(this.holder=!1,platform.socketSendMessage({type:"game",method:"select",data:{x:t,y:i}}))}},t.prototype.onMouseMove=function(e){if(2!=this.status||!this.holder)return void(document.body.style.cursor="default");var t=.5*this.checkerboardSize,i=e.target.x,r=e.target.y;if(e.stageX<i-t||e.stageX>i+t||e.stageY<r-t||e.stageY>r+t)return void(document.body.style.cursor="default");var n=this.view.pieceAlpha,a=this.view.piece,s=e.stageX-this.offsetX,o=e.stageY-this.offsetY,h=this.distance,c=Math.round(s/h),l=Math.round(o/h);n.x=c*h,n.y=l*h,a.x=s,a.y=o,platform.socketSendMessage({type:"game",method:"mousemove",data:{x:s,y:o}}),document.body.style.cursor="none"},t.prototype.setStatus=function(e,t){void 0===t&&(t=[]);var i=this.view;switch(this.status=e,i.result.visible=!1,this.resultAnimate.pause(),e){case 0:this.holder=!1,i.title.text="Gomoku",i.readyButton.visible=!0,i.piece.visible=!1,this.checkerboardList=[];break;case 1:i.title.text="Waiting ...",i.readyButton.visible=!1,i.piece.visible=!1,this.checkerboardList=[];break;case 7:case 2:if(i.readyButton.visible=!1,i.title.text="Playing ...",i.piece.visible=2==e,2==e){this.checkerboardList=[];for(var r=0;225>r;r++)this.checkerboardList.push(0);for(var n in this.removeList)this.view.checkerboard.removeChild(this.removeList[n]);this.removeList.length=0,this.removeList=[]}else{this.checkerboardList=[];for(var a in t)for(var s in t[a]){var o=t[a][s];0!=o&&this.pushPiece(a,s,o),this.checkerboardList.push(o)}}break;case 5:case 4:case 3:this.holder=!1,i.title.text="Gomoku",i.readyButton.visible=!0,i.piece.visible=!1,5>e&&(this.resultAnimate.resume(),i.result.texture=RES.getRes(3==e?"winner_png":"lost_png"),i.result.visible=!0)}},t.prototype.pushPiece=function(e,t,i){this.checkerboardList[15*t+e]=i;var r=new egret.Bitmap;this.removeList.push(r),r.texture=RES.getRes(1==i?"black_png":"white_png"),r.width=r.height=30,this.view.checkerboard.addChild(r),r.width=r.height=200,r.anchorOffsetX=r.anchorOffsetY=100,r.x=e*this.distance,r.y=t*this.distance;var n=this;TweenMax.to(r,.5,{anchorOffsetX:15,anchorOffsetY:15,width:30,height:30,onComplete:function(){n.filter.uniforms.center.x=r.x/n.checkerboardSize,n.filter.uniforms.center.y=1-r.y/n.checkerboardSize,n.filterAnimate.invalidate(),n.filterAnimate.restart(),n.view.checkerboard.addChild(n.view.piece)}})},t.prototype.createGameScene=function(){var e=this.stageW,t=this.stageH,i=new egret.TextField;i.text="Gomoku",i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.width=e,i.height=50,i.size=36,i.x=0,i.y=.2*t+10,i.bold=!0,this.addChild(i);var r=new customerButton({id:"ready",height:40,x:.5*e,y:t-35,text:"READY"});this.addChild(r);var n=new egret.CustomFilter(this.vertex,this.fragment,{center:{x:.5,y:.5},params:{x:10,y:.5,z:.1},time:2});this.filter=n,this.filterAnimate=TweenMax.fromTo(n.uniforms,1,{time:0},{time:2,delay:.5});var a=new eui.Group;this.addChild(a),a.x=.5*e,this.offsetY=.2*t+70,this.checkerboardSize=t-(.2*t+140),this.offsetX=.5*(e-this.checkerboardSize);var s=this.checkerboardSize;a.y=.2*t+70+.5*s,this.distance=s/14,a.anchorOffsetX=.5*s,a.anchorOffsetY=.5*s;var o=new egret.Shape;o.graphics.beginFill(15978627,1),o.graphics.lineStyle(2,0),o.graphics.drawRect(0,0,s,s),o.graphics.endFill(),a.addChild(o);var h=14,c=s/h;o.graphics.lineStyle(1,0);for(var l=0;h>=l;l++){var u=l*c;o.graphics.moveTo(u,0),o.graphics.lineTo(u,s),o.graphics.moveTo(0,u),o.graphics.lineTo(s,u)}for(var d=0;5>d;d++){o.graphics.lineStyle(0,0),o.graphics.beginFill(0);var u=2==d?.5*s:c*(3+(d%2==0?0:8)),g=2==d?.5*s:c*(3+(2>d?0:8));o.graphics.drawCircle(u,g,5),o.graphics.endFill()}var f=new egret.Bitmap;f.width=f.height=30,f.anchorOffsetX=f.anchorOffsetY=15,f.alpha=.45,f.visible=!1,a.addChild(f);var p=new egret.Bitmap;p.width=p.height=36,p.anchorOffsetX=p.anchorOffsetY=15,p.visible=!1,a.addChild(p);var v=new egret.Shape;v.x=0,v.y=0,v.graphics.beginFill(0),v.graphics.drawRect(.5*e,5,this.checkerboardSize,.2*t-10),v.graphics.endFill(),v.anchorOffsetX=.5*this.checkerboardSize,v.alpha=.2,this.addChild(v),this.userScroll=new userScrollview({width:this.checkerboardSize,x:.5*e,y:.1*t,height:.2*t}),this.addChild(this.userScroll);var m=new egret.Bitmap;m.texture=RES.getRes("winner_png"),m.width=m.height=330,m.anchorOffsetX=.5*m.width,m.anchorOffsetY=.5*m.height,this.addChild(m),m.x=.5*e,m.y=.2*t+70+.5*s,m.visible=!1,this.resultAnimate=new TimelineMax({repeat:-1}),this.resultAnimate.add(TweenLite.to(m,.7,{scaleX:1.1,scaleY:1.1,ease:Elastic.easeOut.config(1,.3)})),this.resultAnimate.add(TweenLite.to(m,.7,{scaleX:1,scaleY:1,ease:Elastic.easeOut.config(1,.3)})),this.resultAnimate.pause(),this.view={checkerboard:a,pieceAlpha:f,piece:p,readyButton:r,title:i,result:m},Object.defineProperty(this,"show",{get:function(){return this.visible},set:function(e){if(this.visible!=e){var t=e?this.stageW:0,i=e?0:-this.stageW;this.x=t,e?(this.visible=e,TweenMax.to(this,1,{x:i,onComplete:function(){this.target.listener()}})):(this.listener(),TweenMax.to(this,1,{x:i,onComplete:function(){this.target.visible=!1}}))}}}),Object.defineProperty(this,"holder",{get:function(){return this._holder},set:function(e){this._holder=e,this.view.pieceAlpha.visible=e,this.view.pieceAlpha.texture=RES.getRes(1==this.pieceType?"black_png":"white_png");var t="black_png";t=e?1==this.pieceType?"black_png":"white_png":2==this.pieceType?"black_png":"white_png",this.originalX=this.view.piece.x,this.originalY=this.view.piece.y,this.view.piece.texture=RES.getRes(t)}})},t.prototype.userInit=function(e){for(var t in e){var i=e[t];this.userScroll.add({name:i.n,face:i.f,status:i.s,uuid:i.u})}},t}(eui.Component);__reflect(game.prototype,"game");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,r){function n(e){t.call(r,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(r))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var o=e.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(r,generateJSON.paths[e])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var background=function(e){function t(){var t=e.call(this)||this;t.timeOnEnterFrame=0,t.addEventListener(egret.Event.ENTER_FRAME,t.onEnterFrame,t),t.timeOnEnterFrame=egret.getTimer(),t.html=document.getElementsByTagName("html")[0],t.body=document.getElementsByTagName("body")[0],t.htmlStyle=t.html.style,t.htmlStyle.backgroundColor="transparent",t.body.style.backgroundColor="transparent";var i="resource/assets/bg.jpg";return t.htmlStyle.backgroundImage="url("+i+")",t.count=0,t}return __extends(t,e),t.prototype.onEnterFrame=function(e){this.count=this.count+.3,this.htmlStyle.backgroundPosition=this.count+"px "+this.count+"px"},t}(egret.DisplayObjectContainer);__reflect(background.prototype,"background");var customerButton=function(e){function t(t){var i=e.call(this)||this;return i.text=new egret.TextField,i.background=new egret.Shape,i.backgroundColor=16166712,i.backgroundTouchColor=6710886,i.w=t.width||120,i.h=t.height||60,i.x=t.x||0,i.y=t.y||0,i.id=t.id||"",i.background.graphics.beginFill(i.backgroundColor),i.background.graphics.drawRect(i.w*-.5,i.h*-.5,i.w,i.h),i.background.graphics.endFill(),i.addChild(i.background),i.text.text=t.text||"",i.text.width=i.w,i.text.height=i.h,i.text.x=i.w*-.5,i.text.y=i.h*-.5,i.text.size=t.size||20,i.text.verticalAlign=egret.VerticalAlign.MIDDLE,i.text.textAlign=egret.HorizontalAlign.CENTER,i.addChild(i.text),i}return __extends(t,e),t.prototype.touchEvent=function(e){switch(e.type){case"touchBegin":this.background.graphics.clear(),this.background.graphics.beginFill(this.backgroundTouchColor),this.background.graphics.drawRect(this.w*-.5,this.h*-.5,this.w,this.h),this.background.graphics.endFill();break;case"touchEnd":this.background.graphics.clear(),this.background.graphics.beginFill(this.backgroundColor),this.background.graphics.drawRect(this.w*-.5,this.h*-.5,this.w,this.h),this.background.graphics.endFill()}},t}(eui.Group);__reflect(customerButton.prototype,"customerButton");var loading=function(e){function t(t){var i=e.call(this)||this;return i.text=new egret.TextField,i.background=new egret.Shape,i.count=3,i.w=t.width||450,i.h=t.height||800,i.background.graphics.beginFill(0),i.background.graphics.drawRect(0,0,i.w,i.h),i.background.graphics.endFill(),i.background.alpha=.5,i.addChild(i.background),i.text.text="loading",i.text.width=i.w,i.text.height=i.h,i.text.verticalAlign=egret.VerticalAlign.MIDDLE,i.text.textAlign=egret.HorizontalAlign.CENTER,i.addChild(i.text),Object.defineProperty(i,"show",{get:function(){return this.visible},set:function(e){this.visible=e,this.visible?this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this):this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)}}),i.show=!1,i}return __extends(t,e),t.prototype.onEnterFrame=function(e){this.count+=.1,this.text.text="loading"+".".repeat(this.count%4),this.count>4&&(this.count=0)},t}(eui.Group);__reflect(loading.prototype,"loading");var userScrollview=function(e){function t(t){var i=e.call(this)||this;i.width=t.width||0,i.height=t.height||0,i.x=t.x||0,i.y=t.y||0,i.anchorOffsetX=.5*i.width,i.anchorOffsetY=.5*i.height;var r=new eui.Group;return i.setContent(r),i.content=r,i.content.height=1.005*i.height,i.horizontalScrollPolicy="off",i.list={},i}return __extends(t,e),t.prototype.init=function(){for(var e in this.list)this.content.removeChild(this.list[e].group),delete this.list[e];for(;this.content.numChildren>0;)this.content.removeChild(this.content.getChildAt(0));this.list={}},t.prototype.add=function(e){var t=this.createUserItem(e);this.list[e.uuid]=t;var i=Object.keys(this.list).length;t.group.y=50*Object.keys(this.list).length-37.5,this.content.addChild(t.group),this.content.height=Math.max(50*i+12.5,1.005*this.height)},t.prototype.setStatus=function(e,t){var i=this.list[e];i&&(i.status.text=this.getStatusStr(parseInt(t)))},t.prototype.remove=function(e){var t=this.list[e];if(t){this.content.removeChild(t.group),delete this.list[e];var i=0;for(var r in this.list)this.list[r].group.y=50*++i-37.5;this.content.height=50*i+12.5}},t.prototype.createUserItem=function(e){var t=new eui.Group,i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawRect(0,0,this.width,50),i.graphics.endFill(),i.alpha=0,t.addChild(i);var r=new eui.Label;r.text=e.name||"unknow",r.width=175,r.anchorOffsetY=.5*r.height,r.size=24,r.bold=!0,r.x=75,r.y=25,t.addChild(r);var n=new eui.Label;n.width=175,n.anchorOffsetX=175,n.anchorOffsetY=.5*r.height,n.size=24,n.bold=!0,n.x=this.width-25,n.y=25,n.textAlign="right",n.text=this.getStatusStr(e.status||0),t.addChild(n);var a=new egret.Bitmap;a.texture=RES.getRes((e.face||0)+"_png"),a.width=40,a.height=40,a.x=40,a.y=25,a.anchorOffsetX=.5*a.width,a.anchorOffsetY=25,t.addChild(a);var s=new egret.Shape;return s.graphics.lineStyle(2,16777215),s.graphics.moveTo(75,45),s.graphics.lineTo(this.width-25,45),t.addChild(s),{group:t,status:n,data:e}},t.prototype.getStatusStr=function(e){switch(e){case 0:return"preparing";case 1:return"ready";case 2:return"playing";case 3:return"watch";case 5:return"winner";case 6:return"loser"}},t}(egret.ScrollView);__reflect(userScrollview.prototype,"userScrollview");